<!DOCTYPE html>
<html>
<body>
  <h1>ESP32 Analog Reader</h1>
  <button onclick="connectBLE()">Connexion BLE</button>
  <p id="valueGPIO4">Valeur GPIO4: 0</p>
  <p id="valueGPIO17">Valeur GPIO17: 0</p>

<script>
const SERVICE_UUID = '4fafc201-1fb5-459e-8fcc-c5c9c331914b';
const CHARACTERISTIC_UUID_GPIO4 = 'beb5483e-36e1-4688-b7f5-ea07361b26a8';
const CHARACTERISTIC_UUID_GPIO17 = 'd1b5483e-36e1-4688-b7f5-ea07361b26a9';

let characteristicGPIO4;
let characteristicGPIO17;

async function connectBLE() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ services: [SERVICE_UUID] }]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);

    characteristicGPIO4 = await service.getCharacteristic(CHARACTERISTIC_UUID_GPIO4);
    characteristicGPIO17 = await service.getCharacteristic(CHARACTERISTIC_UUID_GPIO17);

    characteristicGPIO4.addEventListener('characteristicvaluechanged', event => {
      const value = new TextDecoder().decode(event.target.value);
      document.getElementById('valueGPIO4').textContent = `Valeur GPIO4: ${value}`;
    });

    characteristicGPIO17.addEventListener('characteristicvaluechanged', event => {
      const value = new TextDecoder().decode(event.target.value);
      document.getElementById('valueGPIO17').textContent = `Valeur GPIO17: ${value}`;
    });

    await characteristicGPIO4.startNotifications();
    await characteristicGPIO17.startNotifications();

    device.addEventListener('gattserverdisconnected', () => {
      console.log('Déconnecté - Réinitialisation');
      characteristicGPIO4.removeEventListener('characteristicvaluechanged', updateValue);
      characteristicGPIO17.removeEventListener('characteristicvaluechanged', updateValue);
    });
    
  } catch (error) {
    console.error('Erreur:', error);
  }
}
</script>
</body>
</html>

